windowReady = ->
  # Caveat: none of following visual indicators for voting is validated with the database, or success callbacks.

  votedOnModel = false

  votedForThis = (item) => 
    item.find('img').attr('src') == '/assets/upvoted.png'

  voteUp = (item) =>
    votedOnModel = true
    item.find('img').attr('src', '/assets/upvoted.png');

  unvote = (item) =>
    votedOnModel = false
    item.closest('.vote-chart').find('.vote-button > a img').attr('src', '/assets/upvote.png')

  jQuery ($) ->
    # votedOnModel = true if (votes table has record with this votable, and current_user.) How to get this from rails to js? use callback?
    # look up votes table for this user and this votable, and for matching votes, call voteUp() function on the particular one... based on string?

    $('.vote-button > a').click ->
      if !votedOnModel
        voteUp( $(this) )
      else
        unvote( $(this) )
        if !votedForThis( ($this) ) #why is this not working properly?
          voteUp( $(this) )

$(window).load(windowReady);
$(window).on('page:load', windowReady);